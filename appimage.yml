app: AeNux
ingredients:
  script: |
    #!/bin/bash -ex
    # AppImage build script for AeNux
    
    # Set up Python environment
    python3 -m venv venv
    source venv/bin/activate
    pip install --upgrade pip
    pip install PyQt6==6.9.1 pyqt6-qt6==6.9.2 pyqt6-sip==13.10.2
    
    # Copy application files
    cp -r . usr/share/aenux/
    rm -rf usr/share/aenux/.git
    rm -rf usr/share/aenux/.github
    rm -rf usr/share/aenux/debian
    rm -rf usr/share/aenux/aenux-deb
    rm -rf usr/share/aenux/aenux.AppDir
    chmod +x usr/share/aenux/launch_aenux.sh
    
    # Create AppRun
    cat > AppRun << 'EOF'
    #!/bin/bash
    set -e
    
    # Get the directory where AppRun is located
    APPDIR="$(dirname "$(readlink -f "${0}")")"
    
    # Set environment variables
    export QT_QPA_PLATFORM_PLUGIN_PATH="$APPDIR/usr/share/aenux/venv/lib/python3.12/site-packages/PyQt6/Qt6/plugins"
    export QT_QPA_PLATFORM="xcb"
    export PATH="$APPDIR/usr/bin:$PATH"
    
    # Change to the application directory
    cd "$APPDIR/usr/share/aenux"
    
    # Run the application
    exec "$APPDIR/usr/share/aenux/venv/bin/python" run_qt6.py "$@"
    EOF
    chmod +x AppRun
    
    # Create desktop entry
    cat > aenux.desktop << 'EOF'
    [Desktop Entry]
    Name=AeNux Loader
    Comment=Run Adobe After Effects using Wine on Linux
    Exec=aenux
    Icon=aenux
    Terminal=false
    Type=Application
    Categories=AudioVideo;Video;Graphics;
    Keywords=after;effects;adobe;wine;video;editing;
    X-AppImage-Version=1.0.0
    X-AppImage-Name=AeNux
    X-AppImage-Comment=Adobe After Effects for Linux
    EOF
    
    # Copy icon
    if [ -f asset/logo.png ]; then
        cp asset/logo.png aenux.png
    fi
  dist: ubuntu-22.04
  packages:
    - python3
    - python3-venv
    - python3-dev
    - build-essential
    - libqt6gui6
    - libqt6widgets6
    - libqt6core6
    - qt6-base-dev
  sources:
    - ./
  sources-dir: .
  version: 1.9.0
  arch: x86_64
